## 동시성 이슈 (Race Condition)

- 둘 이상의 스레드가 공유 데이터에 동시에 접근하고 수정할 때 발생하는 문제이다.
- 한 번에 하나의 스레드만 데이터에 접근하도록 제어해 정합성을 보장해야 한다.

---

### `synchronized`를 활용한 방법

- `synchronized` 키워드를 사용하면 단일 서버에서는 정합성을 보장할 수 있다.
- 서버가 여러 대일 경우, 인스턴스 간 메모리를 공유하지 않기 때문에 동시성 문제가 발생한다.

---

### MySQL을 활용한 방법

#### 1. Pessimistic Lock

- 데이터를 조회하거나 수정할 때 Exclusive Lock을 설정해 다른 트랜잭션의 접근을 차단한다.
- 정합성을 강하게 보장하지만 락 대기로 데드락이 발생할 수 있다.

#### 2. Optimistic Lock

- 락을 사용하지 않고 버전 정보를 비교해 정합성을 보장한다.
- 업데이트할 때 버전이 일치하면 수정하고, 불일치하면 다시 읽은 후 작업을 수행한다.

#### 3. Named Lock

- 이름을 기반으로 메타데이터 락을 설정해 다른 세션의 접근을 차단한다.
- 트랜잭션 종료와 관계없이 락이 유지되며, 별도 해제 명령이나 선점 시간 만료로 해제된다.

---

### Redis를 활용한 방법
   
#### 1. Lettuce

- `spring-data-redis` 기본 클라이언트로 별도 라이브러리 설치 없이 사용할 수 있다.
- Spin Lock 방식이기 때문에 많은 스레드가 동시에 접근하면 Redis에 부하가 발생할 수 있다.

#### 2. Redisson

- 별도 라이브러리를 추가해 사용하는 방식이다.
- 락 획득 실패 시 재시도 로직을 기본 제공하며, Pub/Sub 방식을 통해 Redis 부하를 줄인다.

> 실무에서는 재시도가 필요 없는 경우 Lettuce를, 필요한 경우 Redisson을 사용한다.

---

### MySQL vs Redis

| 항목 | MySQL | Redis |
|:---:|:---:|:---:|
| 동시성 제어 방식 | DB 트랜잭션 락 | 분산 락 (Spin Lock, Pub/Sub) |
| 구축 및 운영 비용 | 별도 구축 불필요 | 별도 구축 및 운영 필요 |
| 트래픽 처리 능력 | 낮은 트래픽에 적합 | 높은 트래픽에도 안정적 |
| 분산 환경 대응력 | 단일 서버 환경에 적합 | 분산 시스템에 최적화 |
